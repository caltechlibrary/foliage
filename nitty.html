
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="blue-grey">
  <script src="_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Nitty-gritty details &#8212; Foliage</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/material.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Colophon" href="colophon.html" />
    <link rel="prev" title="The Foliage user interface" href="foliage-interface.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=deep-orange data-md-color-accent=teal>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#nitty" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="index.html" title="Foliage"
           class="md-header-nav__button md-logo">
          
              <img src="_static/foliage-icon-white-sm.png" height="26"
                   alt="Home logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Foliage</span>
          <span class="md-header-nav__topic"> Nitty-gritty details </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/caltechlibrary/foliage/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    foliage
  </div>
</a>
          </div>
        </div>
      
      
    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">Home</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="index.html" title="Foliage" class="md-nav__button md-logo">
      
        <img src="_static/foliage-icon-white-sm.png" alt=" logo" width="48" height="48">
      
    </a>
    <a href="index.html"
       title="Foliage">Foliage</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/caltechlibrary/foliage/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    foliage
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="installation.html" class="md-nav__link">Installation</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="installation.html#preliminary-requirements" class="md-nav__link">Preliminary requirements</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="installation.html#installation-instructions" class="md-nav__link">Installation instructions</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="first-time-usage.html" class="md-nav__link">Starting Foliage</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="first-time-usage.html#starting-and-quitting" class="md-nav__link">Starting and quitting</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="first-time-usage.html#first-time-permissions" class="md-nav__link">First-time permissions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="first-time-usage.html#folio-authentication" class="md-nav__link">FOLIO authentication</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="first-time-usage.html#second-time-permissions" class="md-nav__link">Second-time permissions</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="foliage-interface.html" class="md-nav__link">The Foliage user interface</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="foliage-interface.html#tab-look-up-records" class="md-nav__link">Tab: look up records</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="foliage-interface.html#tab-change-records" class="md-nav__link">Tab: change records</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="foliage-interface.html#tab-delete-records" class="md-nav__link">Tab: delete records</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="foliage-interface.html#tab-list-uuids" class="md-nav__link">Tab: list UUIDs</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="foliage-interface.html#tab-other" class="md-nav__link">Tab: other</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Nitty-gritty details </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Nitty-gritty details</a>
      
        
<nav class="md-nav md-nav--secondary">
  <ul class="md-nav__list" data-md-scrollfix="">
  </ul>
</nav>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="#looking-up-records" class="md-nav__link">Looking up records</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#changing-records" class="md-nav__link">Changing records</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="colophon.html" class="md-nav__link">Colophon</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
  <ul class="md-nav__list" data-md-scrollfix="">
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="nitty-gritty-details">
<h1 id="nitty--page-root">Nitty-gritty details<a class="headerlink" href="#nitty--page-root" title="Permalink to this headline">¶</a></h1>
<p>This section delves into some topics in more detail.</p>
<section id="looking-up-records">
<h2 id="looking-up-records">Looking up records<a class="headerlink" href="#looking-up-records" title="Permalink to this headline">¶</a></h2>
<p>In the <em>Look up records</em> tab, you can search for records by simply typing any kind of identifier into the search box. You can also start with one kind of record identifier (e.g., item records) and as Foliage to look up a different kind of record (e.g., loans) by starting with one kind of identifier and telling Foliage to follow the chain of references to get a different kind of record. Depending on what exactly you want to do, some of these operations can be slower than others.</p>
<section id="identifying-the-identifiers">
<h3 id="identifying-the-identifiers">Identifying the identifiers<a class="headerlink" href="#identifying-the-identifiers" title="Permalink to this headline">¶</a></h3>
<p>The first thing Foliage has to do with identifiers in the <em>Look up records</em> tab is to infer the kind of identifiers that you have typed into the window. Unfortunately, the way that FOLIO itself works prevents Foliage from doing this in a simple way: there is no single FOLIO API endpoint where you can ask “what kind of record does this identifier belong to?”. Foliage has to resort to using a combination of pattern recognition and one-by-one questioning to get an answer. This makes some lookups slower than others.</p>
<p>Here is the sequence of tests that Foliage performs on every identifier typed into the lookup box. It stops as soon as it finds an answer:</p>
<ol class="arabic simple">
<li><p>If it’s an integer with length &gt; 7 and starts with <code class="docutils literal notranslate"><span class="pre">350</span></code>, it’s an item barcode.</p></li>
<li><p>If it starts with <code class="docutils literal notranslate"><span class="pre">it</span></code> and the 3rd character is a number, it’s an item record hrid.</p></li>
<li><p>If it starts with <code class="docutils literal notranslate"><span class="pre">ho</span></code> and the 3rd character is a number, it’s a holdings record hrid.</p></li>
<li><p>If it starts with <code class="docutils literal notranslate"><span class="pre">clc.</span></code>, it’s an instance record accession number.</p></li>
<li><p>Does it contain a dash (<code class="docutils literal notranslate"><span class="pre">-</span></code>)?</p>
<ul class="simple">
<li><p><em>Yes</em>:, it’s a unique identifier of some kind, but it’s impossible to tell what kind by simply looking at the identifier. Foliage has to contact each of the following FOLIO subsystems  (which requires a separate network API call) to ask whether it recognizes the unique identifier:</p>
<ol class="arabic simple">
<li><p>item storage: is this an item record id?</p></li>
<li><p>instance storage: is this an instance record id?</p></li>
<li><p>holdings storage: is this a holdings record id?</p></li>
<li><p>loan storage: is this a loan record id?</p></li>
<li><p>user storage: is this a user id?</p></li>
</ol>
</li>
<li><p><em>No</em>: the identifier is ambiguous (e.g., something like <code class="docutils literal notranslate"><span class="pre">634546</span></code>) and could be either an hrid of a kind that doesn’t follow the usual pattern, or else a user barcode. Similar to the “yes” case, Foliage has to make separate API calls to ask different FOLIO subsystems, one after another, if any recognizes the identifier:</p>
<ol class="arabic simple">
<li><p>user storage: is this a user barcode?</p></li>
<li><p>instance storage: is this an instance record hrid?</p></li>
<li><p>item storage: is this an item record hrid?</p></li>
<li><p>holdings storage: is this a holdings record hrid?</p></li>
</ol>
</li>
</ul>
</li>
<li><p>If none of the above succeeds, then Foliage reports the identifier as being unrecognized.</p></li>
</ol>
<p>The above hopefully explains why some lookups are slower than others. The worst-case scenario is unique identifiers that belong to user records; then, Foliage has to make a total of 5 API calls to determine the identifier kind (first asking, and failing, for item, instance, holdings, and loan, before getting a positive answer for user).</p>
<p>Note that the order in which the calls are made is arbitrary and based on guessing what Foliage users might look up most often. The order can be changed, but at present, the tests are done in sequence, so changing the order will simply make some <em>other</em> kind of record slower to identify.</p>
</section>
<section id="one-record-leads-to-another">
<h3 id="one-record-leads-to-another">One record leads to another<a class="headerlink" href="#one-record-leads-to-another" title="Permalink to this headline">¶</a></h3>
<p>The <em>Look up records</em> tab allows you to find a chosen kind of record by starting with a <em>different</em> kind of record identifier. An example of this is starting with an item identifier and getting back loan records for loans involving that item. To achieve this, Foliage sometimes has to do multiple steps, to follow the chain of references between records in FOLIO. Here is a rough summary of how many steps (and thus how slow) different kinds of operations are. Keep in mind that Foliage first has to figure out what kind of identifier it has been given (as discussed in the previous section), so the following steps occur <em>after</em> – and in addition to – any API calls needed for that.</p>
<ol class="arabic simple">
<li><p>Direct lookups of the same kind of identifier (e.g., item records given item identifiers) are fastest and need only a single API call.</p></li>
<li><p>FOLIO item records point to holdings records, and holdings records point to instance records. Going between them takes 1 or 2 API calls, depending on whether FOLIO happens to support a search query for that combination. Not all combinations are covered. For example, getting an instance record given a holdings record id takes 2 API calls: first Foliage uses the holdings id to retrieve the holdings record (first API call), reads the instance identifier inside that record, and then retrieves the actual instance record (second API call).</p></li>
<li><p>Looking up items, holdings and instances starting from user identifiers can take an unpredictable number of API calls, based on the number of loans that the user currently has or (if searching for all loans and not only open loans) that the user has <em>ever</em> made. For example, asking for instance records given a user id requires, for every loan, (a) retrieving the loan record to get the identifier of the item loaned, and then  (b) getting the instance record for that item identifier.  Some users have made dozens of loans, so this process can take an extremely long time.</p></li>
</ol>
</section>
</section>
<section id="changing-records">
<h2 id="changing-records">Changing records<a class="headerlink" href="#changing-records" title="Permalink to this headline">¶</a></h2>
<p>The current implementation of Foliage (version 1.0.x) allows you to change the locations of items and holdings. Changing the location of an item may require behind-the-scenes work to change one or more corresponding holdings record. The following explains the cases that Foliage can handle.</p>
<p>The following convention is used in the diagrams of this section</p>
<ul class="simple">
<li><p>Rounded rectangles represent FOLIO records.</p></li>
<li><p>A filled-in rectangle represents the target of the change operation; dotted rectangles represent records that are changed as a consequence of performing the operation.</p></li>
<li><p>A name beginning with <strong>r</strong> represents an instance record, <strong>h</strong> represents a holdings record, and <strong>i</strong> represents an item record.</p></li>
</ul>
<section id="case-1-instance-record-with-only-one-item-in-one-location">
<h3 id="case-1-instance-record-with-only-one-item-in-one-location">Case 1: instance record with only one item in one location<a class="headerlink" href="#case-1-instance-record-with-only-one-item-in-one-location" title="Permalink to this headline">¶</a></h3>
<p>The simplest case of moving an item is when an instance record has one item in one location, and no other items. To move the item to another location, the item’s location field value needs to be changed and since there are no other items, the holdings record’s location field can simply be changed directly; no new holdings record need to be created and none deleted.</p>
<figure>
<img src="_static/media/foliage-change-case-1.svg" width="300px"/>
<figcaption>Illustration of changes to the hierarchical relationships of records for case 1.</figcaption>
</figure>
</section>
<section id="case-2-instance-record-with-two-items-in-one-location">
<h3 id="case-2-instance-record-with-two-items-in-one-location">Case 2: instance record with two items in one location<a class="headerlink" href="#case-2-instance-record-with-two-items-in-one-location" title="Permalink to this headline">¶</a></h3>
<p>Suppose an instance has two items in the same location, and we want to move one of the items to a new location. The changes needed are as follows: a new holdings record needs to be created to represent the new location; the item’s holdings record reference needs to be changed to point to this new holdings record, and the item’s location value also needs to be changed to the new location.</p>
<figure>
<img src="_static/media/foliage-change-case-2.svg" width="450px"/>
<figcaption>Illustration of changes to the hierarchical relationships of records for case 2.</figcaption>
</figure>
</section>
<section id="case-3-moving-an-item-between-existing-locations">
<h3 id="case-3-moving-an-item-between-existing-locations">Case 3: moving an item between existing locations<a class="headerlink" href="#case-3-moving-an-item-between-existing-locations" title="Permalink to this headline">¶</a></h3>
<p>Suppose an instance has 3 items – two in one location, a third in another. We move one of the items from one location to the other. Changes needed: item 2’s location is changed from location 1 to location 2, and its holdings record reference is changed from <strong>h1</strong> to <strong>h2</strong>. No other changes needed.</p>
<figure>
<img src="_static/media/foliage-change-case-3.svg" width="625px"/>
<figcaption>Illustration of changes to the hierarchical relationships of records for case 3.</figcaption>
</figure>
</section>
<section id="case-4-moving-the-only-item-in-a-location-to-another-location">
<h3 id="case-4-moving-the-only-item-in-a-location-to-another-location">Case 4: moving the only item in a location to another location<a class="headerlink" href="#case-4-moving-the-only-item-in-a-location-to-another-location" title="Permalink to this headline">¶</a></h3>
<p>Suppose an instance has two items in two different locations, and we move one of the items between the locations. This leaves the original location without any items. Changes needed: item 1’s location is changed to the new location and its holdings record reference is changed to the other holdings record (<strong>h2</strong>). Since holdings record <strong>h1</strong> no longer has any items attached to it, we delete that holdings record.</p>
<figure>
<img src="_static/media/foliage-change-case-4.svg" width="500px"/>
<figcaption>Illustration of changes to the hierarchical relationships of records for case 4.</figcaption>
</figure>
</section>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="foliage-interface.html" title="The Foliage user interface"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> The Foliage user interface </span>
              </div>
            </a>
          
          
            <a href="colophon.html" title="Colophon"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Colophon </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2022, Caltech Library.
              
          </div>
            Last updated on
              Jan 21, 2022.
            <br/>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>